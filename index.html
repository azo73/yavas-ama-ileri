<script>
/* ğŸ‘¤ USER */
let username = localStorage.getItem("username");
if(!username){
  username = "guest_" + Math.floor(Math.random()*10000);
  localStorage.setItem("username", username);
}

/* ğŸŒ§ï¸ YAÄMUR */
const rainAudio = document.getElementById("rainAudio");
let rainOn = false;

/* â±ï¸ TIMER */
let workMin = 25;
let breakMin = 5;
let timeLeft = workMin * 60;
let isWork = true;
let running = false;
let interval = null;

/* ğŸ¯ SCORE */
let score = Number(localStorage.getItem("score")) || 0;
let pomos = Number(localStorage.getItem("pomos")) || 0;

/* ğŸ“ TASKS */
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

/* DOM */
const timeEl = document.getElementById("time");
const startBtn = document.getElementById("startBtn");
const rainBtn = document.getElementById("rainBtn");
const tabWork = document.getElementById("tabWork");
const tabBreak = document.getElementById("tabBreak");
const taskInput = document.getElementById("taskInput");
const addTaskBtn = document.getElementById("addTaskBtn");
const taskSelect = document.getElementById("taskSelect");
const workInput = document.getElementById("workInput");
const breakInput = document.getElementById("breakInput");

/* â±ï¸ */
function updateTime(){
  const m = String(Math.floor(timeLeft/60)).padStart(2,"0");
  const s = String(timeLeft%60).padStart(2,"0");
  timeEl.textContent = `${m}:${s}`;
}

/* ğŸ“ */
function renderTasks(){
  taskSelect.innerHTML = '<option value="">GÃ¶rev seÃ§</option>';
  tasks.forEach((t,i)=>{
    const o = document.createElement("option");
    o.value=i;
    o.textContent=`${t.name} (${t.count||0})`;
    taskSelect.appendChild(o);
  });
}

/* â• */
addTaskBtn.onclick = () => {
  if(!taskInput.value) return;
  tasks.push({name:taskInput.value,count:0});
  localStorage.setItem("tasks",JSON.stringify(tasks));
  taskInput.value="";
  renderTasks();
};

/* â–¶ï¸ */
startBtn.onclick = () => {
  if(!running){
    running = true;
    startBtn.textContent = "PAUSE";

    interval = setInterval(()=>{
      timeLeft--;
      updateTime();

      if(timeLeft <= 0){
        if(isWork){
          pomos++;
          score += 10;
          localStorage.setItem("pomos", pomos);
          localStorage.setItem("score", score);

          if(taskSelect.value!==""){
            tasks[taskSelect.value].count++;
            localStorage.setItem("tasks",JSON.stringify(tasks));
            renderTasks();
          }
        }

        isWork = !isWork;
        timeLeft = (isWork ? workMin : breakMin) * 60;
        updateTime();
      }
    },1000);
  }else{
    running = false;
    clearInterval(interval);
    startBtn.textContent = "START";
  }
};

/* ğŸŒ§ï¸ */
rainBtn.onclick = () => {
  if(!rainOn){
    rainAudio.play();
    rainBtn.textContent = "ğŸŒ§ï¸ YaÄŸmur Kapat";
  }else{
    rainAudio.pause();
    rainBtn.textContent = "ğŸŒ§ï¸ YaÄŸmur AÃ§";
  }
  rainOn = !rainOn;
};

/* ğŸ§­ TABLAR â€“ SADECE GÃ–RÃœNÃœM */
tabWork.onclick = () => {
  tabWork.classList.add("active");
  tabBreak.classList.remove("active");
};

tabBreak.onclick = () => {
  tabBreak.classList.add("active");
  tabWork.classList.remove("active");
};

/* âš™ï¸ */
workInput.onchange = ()=> workMin = Number(workInput.value);
breakInput.onchange = ()=> breakMin = Number(breakInput.value);

/* ğŸ”— */
function copyLink(){
  navigator.clipboard.writeText(location.href);
  alert("Link kopyalandÄ±!");
}

renderTasks();
updateTime();
</script>
